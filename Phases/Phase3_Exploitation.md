# Phase 3: Exploitation

**Goal:** Test vulnerability candidates and develop proof of concepts.

---

## Overview

Exploitation is where analysis becomes action. This phase involves systematically testing vulnerability candidates identified in Phase 2, developing working proofs of concept, and documenting security impact.

```
+-------------------+     +-------------------+     +-------------------+
|  Candidates       | --> |  Testing          | --> |  Verified Vulns   |
+-------------------+     +-------------------+     +-------------------+
| - IDOR targets    |     | - Test payloads   |     | - Working PoCs    |
| - SSRF vectors    |     | - Verify impact   |     | - Impact proof    |
| - Logic flaws     |     | - Document steps  |     | - Severity score  |
| - Injection pts   |     | - Capture evidence|     | - Report ready    |
+-------------------+     +-------------------+     +-------------------+
```

---

## Testing by Vulnerability Type

### 1. IDOR Testing

**Methodology:**
```
1. Create two test accounts (A and B)
2. Perform action as Account A
3. Capture the request with resource ID
4. Replace ID with Account B's resource
5. Check if access is granted
```

**Test Cases:**
```markdown
## IDOR Test Matrix

### Horizontal Access (Same Role)
- [ ] Access User B's profile as User A
- [ ] View User B's orders as User A
- [ ] Download User B's files as User A
- [ ] Modify User B's settings as User A

### Vertical Access (Role Escalation)
- [ ] Access admin functions as regular user
- [ ] View all users list as regular user
- [ ] Modify system settings as regular user
- [ ] Delete resources as non-owner

### ID Manipulation
- [ ] Sequential IDs (id=123 -> id=124)
- [ ] Encoded IDs (base64, hex)
- [ ] UUID prediction (if sequential)
- [ ] Hash manipulation
- [ ] Negative/zero values
```

**Example Burp Request:**
```http
GET /api/orders/12345 HTTP/1.1
Host: target.com
Authorization: Bearer <user_a_token>

# Change to:
GET /api/orders/12346 HTTP/1.1
Host: target.com
Authorization: Bearer <user_a_token>
```

### 2. SSRF Testing

**Methodology:**
```
1. Identify URL input feature
2. Test with internal addresses
3. Try cloud metadata endpoints
4. Attempt bypass techniques
5. Verify server-side request
```

**Test Payloads:**
```markdown
## SSRF Payload Checklist

### Basic Internal
- [ ] http://127.0.0.1
- [ ] http://localhost
- [ ] http://[::1]
- [ ] http://0.0.0.0

### Cloud Metadata
- [ ] http://169.254.169.254/latest/meta-data/ (AWS)
- [ ] http://metadata.google.internal/ (GCP)
- [ ] http://169.254.169.254/metadata/instance (Azure)

### Internal Network
- [ ] http://10.0.0.1
- [ ] http://192.168.1.1
- [ ] http://172.16.0.1

### Bypass Techniques
- [ ] http://127.0.0.1.nip.io
- [ ] http://localtest.me
- [ ] http://127.0.0.1:80@attacker.com
- [ ] http://[0:0:0:0:0:ffff:127.0.0.1]
- [ ] URL encoding: http://%31%32%37%2e%30%2e%30%2e%31
```

**Verification Methods:**
- Burp Collaborator
- Self-hosted server (required for Amazon VRP)
- Webhook.site (if allowed by program)

### 3. Business Logic Testing

**Methodology:**
```
1. Understand intended workflow
2. Identify state transitions
3. Test boundary conditions
4. Try out-of-sequence actions
5. Document exploitable scenarios
```

**Test Cases by Category:**

**E-commerce:**
```markdown
- [ ] Add expensive item, apply discount, reduce quantity
- [ ] Modify price in client-side request
- [ ] Negative quantity values
- [ ] Race condition on limited stock
- [ ] Apply multiple discount codes
- [ ] Checkout with zero/negative total
- [ ] Skip payment step in checkout
```

**Authentication:**
```markdown
- [ ] Skip 2FA step (direct to dashboard URL)
- [ ] Reuse password reset token
- [ ] Account takeover via OAuth
- [ ] Session fixation
- [ ] Concurrent session abuse
```

**Financial:**
```markdown
- [ ] Race condition on balance transfer
- [ ] Double spending via race condition
- [ ] Rounding errors in conversion
- [ ] Refund to different account
- [ ] Negative amount transfer
```

### 4. Injection Testing

**SQL Injection:**
```markdown
## SQLi Test Cases

### Detection Payloads
- ' (single quote - error based)
- " (double quote)
- ' OR '1'='1
- ' OR '1'='1'--
- 1; SELECT * FROM users--

### Time-Based (Blind)
- ' AND SLEEP(5)--
- '; WAITFOR DELAY '0:0:5'--
- ' AND pg_sleep(5)--

### Boolean-Based (Blind)
- ' AND 1=1--
- ' AND 1=2--

### Locations to Test
- [ ] Search parameters
- [ ] Filter values
- [ ] Sort fields
- [ ] ID parameters
- [ ] Login fields
```

**XSS Payloads:**
```markdown
## XSS Test Cases

### Basic
- <script>alert(1)</script>
- <img src=x onerror=alert(1)>
- <svg onload=alert(1)>

### Filter Bypass
- <ScRiPt>alert(1)</ScRiPt>
- <img src=x onerror="alert(1)">
- javascript:alert(1)
- <body onload=alert(1)>

### DOM XSS
- #<script>alert(1)</script>
- javascript:alert(document.domain)

### Context Specific
- " onmouseover="alert(1)
- "><script>alert(1)</script>
- ';alert(1)//
```

**Command Injection:**
```markdown
## Command Injection Test Cases

### Basic
- ; ls
- | ls
- `ls`
- $(ls)

### Time-Based
- ; sleep 5
- | ping -c 5 127.0.0.1
- `sleep 5`

### Locations
- [ ] File upload names
- [ ] API parameters
- [ ] Admin functions
- [ ] Import features
```

### 5. Subdomain Takeover

**Methodology:**
```
1. Identify CNAME pointing to service
2. Verify service is unclaimed (error page)
3. Claim the service
4. Verify control of subdomain
5. Report (serve minimal proof)
```

**Service-Specific Claims:**

| Service | Fingerprint | Claim Method |
|---------|-------------|--------------|
| GitHub Pages | "There isn't a GitHub Pages site here" | Create repo matching subdomain |
| AWS S3 | "NoSuchBucket" | Create bucket with same name |
| Heroku | "No such app" | Create app with custom domain |
| Shopify | "Sorry, this shop is currently unavailable" | Configure store domain |

**Amazon VRP Requirement:**
```html
<!-- Serve this on hidden path -->
<!-- /proof_yourh1username.html -->
<!-- Your H1 username in HTML comment: yourh1username -->
```

---

## Proof of Concept Development

### PoC Requirements

```markdown
## Minimum PoC Requirements

1. **Reproducible** - Steps that work consistently
2. **Minimal** - Simplest path to demonstrate
3. **Safe** - No destructive actions
4. **Documented** - Clear instructions
5. **Evidenced** - Screenshots/recordings
```

### PoC Template

```markdown
# Proof of Concept: [Vulnerability Name]

## Summary
Brief description of the vulnerability.

## Affected Endpoint
- URL: https://target.com/api/vulnerable
- Method: POST
- Parameter: user_id

## Prerequisites
- Valid user account
- Authentication token

## Steps to Reproduce
1. Login as User A (attacker)
2. Navigate to [URL]
3. Intercept request with Burp
4. Change parameter X to Y
5. Forward request
6. Observe unauthorized access

## Request
\`\`\`http
POST /api/vulnerable HTTP/1.1
Host: target.com
Authorization: Bearer <token>
Content-Type: application/json

{"user_id": "victim_id"}
\`\`\`

## Response
\`\`\`json
{
  "success": true,
  "data": {
    "victim_sensitive_data": "..."
  }
}
\`\`\`

## Impact
- Access to other users' PII
- Potential data breach
- Privacy violation

## Evidence
- [Screenshot 1]
- [Video recording]
- [Request/Response logs]
```

---

## Impact Assessment

### CVSS Calculator

Use CVSS 3.1 for severity scoring:

| Metric | Options |
|--------|---------|
| Attack Vector | Network/Adjacent/Local/Physical |
| Attack Complexity | Low/High |
| Privileges Required | None/Low/High |
| User Interaction | None/Required |
| Scope | Unchanged/Changed |
| Confidentiality | None/Low/High |
| Integrity | None/Low/High |
| Availability | None/Low/High |

### Impact Matrix

| Vulnerability | CIA Impact | Typical CVSS |
|---------------|------------|--------------|
| RCE | C:H I:H A:H | 9.0-10.0 |
| SQLi (data exfil) | C:H I:L A:L | 7.0-9.0 |
| IDOR (PII) | C:H I:N A:N | 6.0-8.0 |
| SSRF (internal) | C:H I:L A:L | 7.0-9.0 |
| XSS (stored) | C:L I:L A:N | 4.0-6.0 |
| Subdomain takeover | C:L I:L A:N | 4.0-6.0 |
| Business logic | Variable | 4.0-8.0 |

---

## Testing Safety

### Do's
- Test only in-scope assets
- Use your own test accounts
- Follow rate limits
- Stop at proof of impact
- Report immediately upon validation

### Don'ts
- Access other users' real data
- Perform destructive actions
- Exfiltrate actual data
- Attempt post-exploitation
- Test production systems excessively

### Amazon VRP Specific
- Max 5 requests/second
- Use required User-Agent
- Self-hosted infrastructure only
- No 3rd party tools (XSS Hunter)

---

## Evidence Collection

### What to Capture

```markdown
## Evidence Checklist

- [ ] Full HTTP request
- [ ] Full HTTP response
- [ ] Timestamps
- [ ] IP addresses used
- [ ] Screenshots of impact
- [ ] Video walkthrough (for complex flows)
- [ ] Application logs (if accessible)
```

### Screenshot Requirements

```markdown
## Screenshot Best Practices

1. Clear, readable resolution
2. Highlight relevant data
3. Show URL bar for context
4. Include timestamps
5. Redact sensitive PII
6. Show before/after for changes
```

---

## Findings Tracker

```markdown
## Findings Log

| Date | Vulnerability | Endpoint | Severity | Status | Notes |
|------|--------------|----------|----------|--------|-------|
| 2025-01-15 | IDOR | /api/users | High | Confirmed | PII access |
| 2025-01-16 | SSRF | /webhook | Medium | Testing | Need to verify |
| 2025-01-17 | XSS | /search | Low | Confirmed | Reflected |
```

---

## Phase 3 Checklist

### Before Testing
- [ ] Review scope and rules
- [ ] Prepare test accounts
- [ ] Set up interception proxy
- [ ] Configure rate limiting
- [ ] Prepare payload lists

### During Testing
- [ ] Test one vulnerability type at a time
- [ ] Document all attempts
- [ ] Capture full requests/responses
- [ ] Take screenshots immediately
- [ ] Note any interesting behaviors

### After Finding
- [ ] Verify reproducibility
- [ ] Assess full impact
- [ ] Calculate CVSS score
- [ ] Prepare minimal PoC
- [ ] Collect all evidence

---

## Next Phase

Once vulnerabilities are verified, proceed to [Phase 4: Reporting](Phase4_Reporting.md) to document and submit findings.
